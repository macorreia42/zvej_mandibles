---
title: "Mandibular shape in the Meso-Neolithic transition: the Zvejnieki case study"
author: "Maria Ana Correia"
date: '`r format(Sys.time(), "%d/%m/%Y")`'
subtitle: "Analyses Scripts"
output:
  html_document:
    code_folding: hide
    code_link: true
    keep_md: true
    toc: true
    toc_float: true
    df_print: paged
  pdf_document:
    latex_engine: xelatex
    citation_package: default
    includes:
      in_header: mypackages.tex
bibliography: references.bib
link-citations: true
csl: apa-single-spaced
---

This file documents the geometric morphometrics of Zvejnieki mandibles. 3D landmarks were collected using 3DSlicer and statistical analyses used geomorph and SlicerMorph/SllicerMorphR [@adams2025; @rolfe2021].

```{r setup, echo=FALSE,include=FALSE}
#this makes images save in folder in directory
knitr::opts_chunk$set(
  echo = TRUE, #shows code
  warning = FALSE, message = FALSE, #stops warning messages
  fig.path = "images/",
  dev = c("svg", "png", "tiff"), #saves figures as svg, tiff, and png in images folder
  dpi = 500, #publishing quality for combination art (Elsevier)
  tidy.opts=list(width.cutoff=60), # stops code from running off page
  tidy=TRUE
)

# function to load or install from CRAN or GitHub
# installs missing packages when sharing with others
load_or_install <- function(pkg, github = NULL) {
  # If package not available, install it
  if (!requireNamespace(pkg, quietly = TRUE)) {
    if (is.null(github)) {
      # Install from CRAN
      install.packages(pkg, dependencies = TRUE)
    } else {
      # Install from GitHub (needs remotes package)
      if (!requireNamespace("remotes", quietly = TRUE)) {
        install.packages("remotes")
      }
      remotes::install_github(github, dependencies = TRUE)
    }
  }
  # Finally load it
  suppressPackageStartupMessages(
    library(pkg, character.only = TRUE)
  )
}

```

```{r packages, echo=FALSE,include=FALSE}
# CRAN packages
cran_pkgs <- c("tidyverse", "styler", "geomorph", "osfr")

purrr::walk(cran_pkgs, load_or_install)

# GitHub packages (supply the repo as github = "user/repo")
load_or_install("SlicerMorphR", github = "SlicerMorph/SlicerMorphR")


```

```{r functions, eval=FALSE,include=FALSE}
#!setting decimals
fmt_decimals <- function(decimals = 0) {
  function(x) format(x, nsmall = decimals, scientific = FALSE)
}
#graphical settings for ggplot
my_theme <- theme(
  axis.text = element_text(size = 8, colour = "black"),
  # makes numbers smaller and black (consider final display)
  axis.ticks = element_line(linewidth = 0.5,
                            colour = "black"),
  # same for ticks
  axis.title = element_text(size = 10),
  # and for axis titles
  panel.grid.minor = element_blank(),
  panel.background = element_blank(),
  panel.grid.major = element_blank(),
  panel.border = element_rect(
    colour = "black", fill = NA, size = 0.5)
)

#calculate outliers

is_outlier <- function(x) {
  return(
    x < quantile(x, 0.25, na.rm = TRUE) - 1.5 * IQR(x, na.rm = TRUE) |
      x > quantile(x, 0.75, na.rm = TRUE) + 1.5 * IQR(x, na.rm = TRUE)
  )
}

```

```{r variables, eval=FALSE, include=FALSE}
# OSF project + component IDs
proj_node <- osf_retrieve_node("vkat9") # main project
raw_comp <- osf_retrieve_node("kwafd") # Raw Data component
derived_comp <- osf_retrieve_node("9fnsp") # Derived Data component

# Local save path (your GitHub project directory)
local_out <- file.path(
  "C:/Users/corre/Documents/GitHub/zvej_mandibles",
  "landmark_array.RDS"
)

# List and download raw JSONs
raw_files <- osf_ls_files(raw_comp) %>%
  filter(str_detect(name, "\\.json$")) # keep only JSON
#test <- read.markups.json("ILH_Zvejnieki_34.6.35_merged_miss.mrk.json")
```

```{r tidy, echo=FALSE,eval=FALSE}

```

TODO: add an **OSF download step for reviewers**, so that when they run the Rmd they can skip the local GitHub file and pull the tidy `.RDS` directly from Derived Data

```{r stats, echo=FALSE}


```

# References

::: {#refs}
:::

```{r  session, echo=FALSE}
sessionInfo()
```
